<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cloud Notepad (GitHub Storage)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; }
    label { font-weight: bold; }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0 15px;
      box-sizing: border-box;
    }
    textarea { height: 300px; resize: vertical; }
    .buttons { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #fff;
    }
    .load { background: #3498db; }
    .save { background: #2ecc71; }
    .clear { background: #e74c3c; }
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 6px;
      display: none;
    }
    .info { background: #ebf5fb; color: #1b4f72; }
    .success { background: #e8f8f0; color: #1e8449; }
    .error { background: #fdecea; color: #922b21; }
    .config {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üìù Cloud Notepad (GitHub) by Eliza Abing</h1>

  <div class="config">
    <label>GitHub Owner</label>
    <input id="owner" placeholder="your-username" />

    <label>Repository Name</label>
    <input id="repo" placeholder="your-repo" />

    <label>Branch</label>
    <input id="branch" value="main" />

    <label>GitHub Token</label>
    <input id="token" placeholder="ghp_ / github_pat_..." />
  </div>

  <label>File Path (include folders)</label>
  <input id="filename" placeholder="notes/ideas.txt" />

  <label>Content</label>
  <textarea id="content"></textarea>

  <div class="buttons">
    <button class="load" onclick="loadFile()">Load</button>
    <button class="save" onclick="saveFile()">Save</button>
    <button class="clear" onclick="clearText()">Clear</button>
  </div>

  <div id="status" class="status info"></div>
</div>

<script>
const apiBase = "https://api.github.com";

function showStatus(msg, type = "info") {
  const el = document.getElementById("status");
  el.textContent = msg;
  el.className = `status ${type}`;
  el.style.display = "block";
}

function getConfig() {
  return {
    owner: owner.value.trim(),
    repo: repo.value.trim(),
    branch: branch.value.trim(),
    token: token.value.trim(),
    filename: filename.value.trim(),
    content: content.value
  };
}

const headers = (token) => ({
  "Authorization": `Bearer ${token}`,
  "Accept": "application/vnd.github+json"
});

/* ---------- LOAD ---------- */
async function loadFile() {
  const { owner, repo, branch, token, filename } = getConfig();

  if (!owner || !repo || !token || !filename) {
    return showStatus("Missing required fields.", "error");
  }

  try {
    showStatus("Loading file...", "info");

    const res = await fetch(
      `${apiBase}/repos/${owner}/${repo}/contents/${filename}?ref=${branch}`,
      { headers: headers(token) }
    );

    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.message || "Load failed");
    }

    const data = await res.json();
    const text = decodeURIComponent(
      escape(atob(data.content.replace(/\n/g, "")))
    );

    content.value = text;
    showStatus("File loaded successfully.", "success");
  } catch (e) {
    showStatus(`Error: ${e.message}`, "error");
  }
}

/* ---------- SAVE ---------- */
async function saveFile() {
  const { owner, repo, branch, token, filename, content: text } = getConfig();

  if (!owner || !repo || !token || !filename) {
    return showStatus("Missing required fields.", "error");
  }

  try {
    showStatus("Saving file...", "info");

    let sha = null;

    const check = await fetch(
      `${apiBase}/repos/${owner}/${repo}/contents/${filename}?ref=${branch}`,
      { headers: headers(token) }
    );

    if (check.ok) {
      sha = (await check.json()).sha;
    }

    const encoded = btoa(unescape(encodeURIComponent(text)));

    const res = await fetch(
      `${apiBase}/repos/${owner}/${repo}/contents/${filename}`,
      {
        method: "PUT",
        headers: headers(token),
        body: JSON.stringify({
          message: "Update via Cloud Notepad",
          content: encoded,
          branch,
          sha
        })
      }
    );

    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.message || "Save failed");
    }

    showStatus("File saved successfully.", "success");
  } catch (e) {
    showStatus(`Error: ${e.message}`, "error");
  }
}

function clearText() {
  content.value = "";
  showStatus("Editor cleared.", "success");
}
</script>

</body>
</html>
